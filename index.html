<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Get Hooked on Git Hooks</title>
    <link rel="stylesheet" href="deck.js/core/deck.core.css">
    <link rel="stylesheet" href="deck.js/themes/style/web-2.0.css">
    <link rel="stylesheet" href="deck.js/themes/transition/horizontal-slide.css">
    <link rel="stylesheet" href="deck.js/extensions/status/deck.status.css">
    <link rel="stylesheet" href="google-code-prettify/src/prettify.css">
    <link rel="stylesheet/less" href="styles.less">
    <script src="less-1.3.1.min.js"></script>
    <script src="deck.js/modernizr.custom.js"></script>
</head>

<body>
<section class="slide title">
    <h1 class="get">Get Hooked</h1>
    <h1 class="git">on Git Hooks</h1>
    <div><img alt="Fishing hooks" src="images/hooks.jpg"></div>
</section>

<section class="slide about-me">
    <div class="centered">
        <img alt="Omni Adams" class="pull-left" src="images/omni-simpson.jpg">
        <ul class="pull-right">
            <li>Omni Adams</li>
            <li>@omnicolor</li>
            <li>http://omni-spot.blogspot.com</li>
            <li>omni@digitaldarkness.com</li>
            <li>https://joind.in/8200</li>
        </ul>
    </div>
    <ul class="note">
        <li>1st, a little about me</li>
        <li>my name is</li>
        <li>find me on the twitter</li>
        <li>check out my blog</li>
        <li>feel free to email me</li>
        <li>This slide will be repeated at the end of this session</li>
        <li>And I will put the slides up somewhere as well</li>
        <li>a few things about this talk</li>
        <li>I try to be funny, it's okay to laugh</li>
        <li>If you're easily offended</li>
        <li>Feel free to ask questions</li>
        <li>Don't be scared by the number in the lower right</li>
    </ul>
</section>

<section class="slide captain-hook">
    <img alt="http://wtfshiznit.blogspot.com/2011/04/wtf-hoff.html"
            class="centered" src="images/captain-hook.jpg">
    <ul class="note">
        <li>First off, what is a git hook?</li>
        <li>No, we're not talking about pirates</li>
        <li>I assume you're all using git</li>
        <li>This talk might be slightly useful if you use Subversion</li>
        <li>It does have some of the same concepts</li>
        <li>But everything will be done slightly differently</li>
        <li>And will probably use different terminology</li>
        <li>So what do &rarr; git hooks</li>
    </ul>
</section>

<section class="slide what-do-you-do">
    <img alt="http://edaltorfer.com/blog/wp-content/uploads/2011/08/WhatWouldYouSayYouDoHere.png"
            class="centered" src="images/what-do-you-do.png">
    <ul class="note">
        <li>do here?</li>
        <li>That's really up to your imagination</li>
        <li>I'm going to show you a few examples</li>
        <li>Hopefully that inspires you to create your own</li>
        <li>If you were really feeling crazy you could create a CI</li>
        <li>but a better CI: it could reject things that would break it</li>
    </ul>
</section>

<section class="slide gatekeeper">
    <img alt="http://www.saalonmuyo.com/wp-content/uploads/2012/08/ghostbusters-gatekeeper.jpeg"
        class="centered" src="images/gatekeeper.jpg">
    <ul class="note">
        <li>Git hooks can act as a gatekeeper</li>
        <li>Inspecting your code ahead of time</li>
        <li>and bring down ancient Sumerian gods of destruction</li>
        <li>if the code isn't good enough</li>
        <li>Or after the fact it can hunt you down and... uhhh &rarr; politely</li>
    </ul>
</section>

<section class="slide dexter">
    <img alt="http://images5.fanpop.com/image/photos/25200000/Dexter-plastic-sheets-dexter-25239677-1511-911.jpg"
            class="centered" src="images/dexter.jpg">
    <ul class="note">
        <li>let you know that you did something wrong</li>
        <li>it can send out emails</li>
        <li>or publish reports</li>
        <li>or change build indicators</li>
        <li>Git hooks can even &rarr; change history</li>
    </ul>
</section>

<section class="slide mcfly">
    <img alt="http://themoviedoc.tumblr.com/post/4990263114/destiny"
            class="centered" src="images/mcfly.jpg">
    <ul class="note">
        <li>... change history</li>
        <li>seriously though, hooks are very powerful</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>There's a bunch of different places you can add hooks</li>
        <li>Here's a diagram of common actions in git</li>
        <li>along with the hooks for each step</li>
        <li>The white box is where you do your work</li>
        <li>Yellowish boxen are git commands that you execute on locally</li>
        <li>Gray boxen happen on the server</li>
        <li>Finally, bright yellow boxen are where the git hooks happen</li>
        <li>Git hooks on the left of the action happen before it</li>
        <li>things on the right happen after it</li>
        <li>And update is a weird case</li>
    </ul>
</section>

<section class="slide no-email">
    <img alt="http://blog.swabr.com/wp-content/uploads/2012/10/no-email.jpg"
            class="centered" src="images/no-email.jpg">
    <ul class="note">
        <li>A quick note</li>
        <li>git was written by and for the Linux Kernel developers</li>
        <li>their workflow involves lots of patches via email</li>
        <li>Most of us don't develop this way, we use a central git server</li>
        <li>like github, or whatever you've got set up at work</li>
        <li>There are 3 hooks associated with this</li>
        <li>applyprepatch-msg, pre-applypatch, and post-applypatch</li>
        <li>I'm going to ignore them since the PHP community doesn't use them</li>
    </ul>
</section>

<section class="slide overview">
    <img alt="Overview map" class="centered" src="images/overview.png">
    <ul class="note">
        <li>First I'm going to run quickly through the available hooks</li>
        <li>I'll give a high-level overview of each</li>
        <li>and what you might want use them for</li>
        <li>Then we'll get into how to actually write the hooks</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase highlight">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>Let's start at the left</li>
        <li>How many of y'all use rebase?</li>
        <li>Rebase is a bit like magic and is really powerful</li>
        <li>But with great power &rarr; comes great</li>
    </ul>
</section>

<section class="slide great-power">
    <img alt="http://lifeboat.com/ex/great.power.great.responsibility"
            class="centered" src="images/great-power.jpg">
    <ul class="note">
        <li>comes great ... responsibility</li>
        <li>If you push your changes to a remote</li>
        <li>then rebase and push again</li>
        <li>very bad things can happen</li>
        <li>To keep you from killing Uncle Ben</li>
        <li>you can use a pre-rebase hook to stop you</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout highlight">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>Next up is the post-checkout hook</li>
        <li>Any of y'all use lots of branches</li>
        <li>and frequently switch between them?</li>
        <li>post-checkout lets you reboot your &rarr; universe</li>
    </ul>
</section>

<section class="slide universe">
    <img alt="http://imgur.com/gallery/lxHqF" class="centered"
            src="images/in-the-beginning.jpg">
    <ul class="note">
        <li>For example, if you have config files that aren't checked in</li>
        <li>and are different for different branches</li>
        <li>the post-checkout hook can move config files around</li>
        <li>Or if you use compiled JS or CSS, you can immediately recompile</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge highlight">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>The post-merge hook gets run after a successful merge</li>
        <li>And by successful I mean, no errors</li>
        <li>That doesn't mean the code itself is good</li>
        <li>Especially if you have junior &rarr; developers</li>
    </ul>
</section>

<section class="slide merge-conflict">
    <img alt="http://chuva-inc.com/sites/default/files/blog_posts/356merge-conflicts.jpg"
            class="centered"
            src="http://chuva-inc.com/sites/default/files/blog_posts/356merge-conflicts.jpg">
    <ul class="note">
        <li>developers ... on your team</li>
        <li>After all, git won't complain about leaving the conflict in</li>
        <li>You can git pull and see there's a conflict</li>
        <li>then without editing the file git add and commit it</li>
        <li>And yes, I've had a teammate do that</li>
        <li>So you might want to run lint on your project after merging</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit highlight">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>The most interesting local hook is the pre-commit</li>
        <li>It gets run before you even type in your commit message</li>
        <li>You can use this to run static analysis tools</li>
        <li>Which allows you to &rarr; avoid hurting yourself or your code base</li>
    </ul>
</section>

<section class="slide cork">
    <img alt="http://thelottolife.com/storage/ruprecht.jpg?__SQUARESPACE_CACHEVERSION=1335481235961"
            class="centered" src="images/ruprecht.jpg">
    <ul class="note">
        <li>... avoid hurting yourself or your code base</li>
        <li>Pretty much anything you can run from the command line</li>
        <li>to tell you your code is broken can be done here</li>
        <li>and automatically reject bad changes</li>
        <li>One thing I like here is to scan for certain words</li>
        <li>like no-commit in all caps</li>
        <li>Then I put that in a comment with debugging code</li>
        <li>The hook checks for that and rejects it if it finds it</li>
        <li>This keeps me from accidentally committing debugging stuff</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg highlight">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>The prepare commit message hook isn't all that useful</li>
        <li>If you have a system that makes commits automatically</li>
        <li>you might use it, or if you wanted to automatically add info</li>
        <li>It lets you change the commit &rarr; message</li>
    </ul>
</section>

<section class="slide message-for-you">
    <img alt="http://cheezburger.com/4404460544" class="centered"
            src="images/message-for-you.jpg">
    <ul class="note">
        <li>message ... before it gets edited</li>
        <li>So you might want to put the output of lint or phploc</li>
        <li>Or the status of unit tests</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg highlight">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>The commit message hook runs after you save your commit message</li>
        <li>but before your message gets committed to your local repo</li>
        <li>It's your last chance to stop yourself &rarr; before</li>
    </ul>
</section>

<section class="slide seven">
    <img alt="http://tomshone.blogspot.com/2010/04/horror-movies-in-broad-daylight.html"
            class="centered" src="images/seven.jpg">
    <ul class="note">
        <li>before ... you shoot someone in the head</li>
        <li>or yourself in the foot</li>
        <li>If you require bug numbers in commit messages</li>
        <li>Or run a scan to keep profanity out</li>
        <li>You'd run that here</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit highlight">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>Next up is post-commit</li>
        <li>It's too late to stop the commit</li>
        <li>But you can rebuild documentation</li>
        <li>or your ctags or whatever</li>
    </ul>
</section>

<section class="slide gc">
    <img alt="http://portlandfoodcoma.blogspot.com/2011_04_01_archive.html"
        class="centered" src="images/men-at-work.jpg">
    <ul class="note">
        <li>There's also pre-auto-gc that runs when git gc --auto is run</li>
        <li>Some git commands that might create loose objects run gc</li>
        <li>I'm really not sure why you would ever use this hook</li>
        <li>Finally, there's post-rewrite that runs after some rewrites</li>
        <li>Like commit --amend or rebase</li>
        <li>Not sure why you'd use it either</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <div class="dividing-line"></div>
    <ul class="note">
        <li>That's all for the client-side hooks</li>
        <li>The biggest problem with client side hooks are that</li>
        <li>developers have to install them</li>
        <li>And they can turn them off or change them at any time</li>
        <li>No real way for the server to know they've done so</li>
        <li>To the right of this dividing line, are server-side hooks</li>
        <li>Since these are installed on the bare repo</li>
        <li>devs can't avoid them</li>
        <li>This line &rarr; is a bit arbitrary</li>
    </ul>
</section>

<section class="slide over-the-line">
    <img alt="http://skiffleboom.wordpress.com/2011/12/14/walter-sobchak-motivational-poster-over-the-line-skiffleboom-com/"
            class="centered" src="images/over-the-line.jpg">
    <ul class="note">
        <li>is a bit arbitrary ... since git is distributed</li>
        <li>any repo can receive pushes from any other</li>
        <li>Many companies have a central git repo that is the real master</li>
        <li>In which case this division makes sense</li>

    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive highlight">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>The first of the server hooks is pre-receive</li>
        <li>This hook is the most powerful in my opinion</li>
        <li>git runs this when someone is pushing to it</li>
        <li>exiting with a non-zero code rejects the entire push</li>
        <li>This means that you can use pre-receive &rarr; as a bouncer</li>
    </ul>
</section>

<section class="slide bouncer">
    <img alt="http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2009/9/15/1253005192978/Patrick-Swayze-in-Road-Ho-026.jpg"
            class="centered" src="images/road-house.jpg">
    <ul class="note">
        <li>... as a bouncer</li>
        <li>And your bouncer can be as picky as you want it to be</li>
        <li>It can run lint to make sure there's no syntax errors</li>
        <li>It can run unit tests and reject a push if they fail</li>
        <li>It can run PHPCS and reject code that doesn't meet style...</li>
        <li>Basically anything that you want to keep out of your codebase</li>
        <li>and can programatically searched for can be rejected here</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive highlight">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook">Update</div>
    </div>
    <ul class="note">
        <li>The penultimate hook is the post-receive hook</li>
        <li>This runs after code has been accepted by git</li>
        <li>Exiting non-zero has no effect here</li>
        <li>But you can do things like build documentation</li>
        <li>or upload the new code to a QA server or production</li>
        <li>With just pre-receive and post-receive</li>
        <li>you can hack together a continuous integration server</li>
        <li>Most of the things you'd want to do here</li>
        <li>you *can* do manually, but &rarr; you'll drive yourself crazy</li>
    </ul>
</section>

<section class="slide fight-club">
    <img alt="http://images.fanpop.com/images/image_uploads/Edward-in-Fight-Club-edward-norton-562432_1600_900.jpg"
            class="centered" src="images/fight-club.jpg">
    <ul class="note">
        <li>... you'll drive yourself crazy</li>
        <li>It turns out that computers are really good at repetitive tasks</li>
        <li>they never get tired or miss a step</li>
        <li>If you look at some of these hooks as ways of automating out BS</li>
        <li>you can make your life as a developer so much better</li>
    </ul>
</section>

<section class="slide git-workflow">
    <div class="big-sticky clone">Clone</div>
    <div class="big-sticky checkout">
        Checkout
        <div class="small-sticky post-checkout">Post-checkout</div>
    </div>
    <div class="big-sticky merge">
        Merge
        <div class="small-sticky post-merge">Post-merge</div>
    </div>
    <div class="big-sticky add">Add</div>
    <div class="big-sticky commit">
        Commit
        <div class="small-sticky post-commit">Post-commit</div>
        <div class="small-sticky pre-commit">Pre-commit</div>
        <div class="small-sticky prepare-commit-msg">Prepare-commit-message</div>
        <div class="small-sticky commit-msg">Commit-msg</div>
    </div>
    <div class="big-sticky push">Push</div>
    <div class="big-sticky pull">Pull</div>
    <div class="big-sticky rebase">
        Rebase
        <div class="small-sticky pre-rebase">Pre-rebase</div>
    </div>
    <div class="big-sticky work">Work</div>
    <div class="big-sticky receive">
        Receive
        <div class="small-sticky pre-receive">Pre-receive</div>
        <div class="small-sticky post-receive">Post-receive</div>
    </div>
    <div class="big-sticky update">
        Update
        <div class="small-sticky update-hook highlight">Update</div>
    </div>
    <ul class="note">
        <li>Finally, there's the update hook</li>
        <li>While it sounds very useful</li>
        <li>it's a little less useful in practice</li>
        <li>It's like &rarr; mini-pre-receive</li>
    </ul>
</section>

<section class="slide mini-me">
    <img alt="http://rollinspsychtips.blogspot.com/2012/06/get-rid-of-mini-me-algorithm.html"
            class="centered" src="images/minime.jpg">
    <ul class="note">
        <li>... mini-pre-receive</li>
        <li>Where pre-receive looks at the entire push</li>
        <li>and accepts or rejects the whole push</li>
        <li>update runs once for each branch the user is pushing to</li>
    </ul>
</section>

<section class="slide hooked">
    <div>now</div>
    <div>that</div>
    <div>you're</div>
    <div class="hooked">hooked</div>
    <ul class="note">
        <li>That's all of the hooks you have at your disposal</li>
        <li>So how do you actual use git hooks</li>
        <li>First we'll talk briefly about how to enable them</li>
        <li>And show some examples of how they work</li>
        <li>Then we'll write one</li>
        <li>The rest of this presentation will be much more technical</li>
    </ul>
</section>

<section class="slide background">
    <div>background</div>
    <ul class="note">
        <li>Where can you find the hooks?</li>
        <li>That depends on whether you're using a normal or bare repo</li>
        <li>For those of you that don't know about bare repositories</li>
        <li>they special repositories meant for pushing</li>
        <li>as opposed to your normal git repositories</li>
        <li>that are meant for pulling</li>
        <li>If you try to push to a normal repository</li>
        <li>that has is using the branch you're pushing to</li>
        <li>you'll see something like &rarr; this</li>
    </ul>
</section>

<section class="slide even-smaller">
    <pre class="cli no-bottom">
remote: error: refusing to update checked out branch: refs/heads/master
remote: error: By default, updating the current branch in a non-bare repository
remote: error: is denied, because it will make the index and work tree inconsistent
remote: error: with what you pushed, and will require 'git reset --hard' to match
remote: error: the work tree to HEAD.
remote: error:
remote: error: You can set 'receive.denyCurrentBranch' configuration variable to
remote: error: 'ignore' or 'warn' in the remote repository to allow pushing into
remote: error: its current branch; however, this is not recommended unless you
remote: error: arranged to update its work tree to match what you pushed in some
remote: error: other way.
remote: error:
remote: error: To squelch this message and still keep the default behaviour, set
remote: error: 'receive.denyCurrentBranch' configuration variable to 'refuse'.
To /Users/Omni/code/hooks
 ! [remote rejected] master -&gt; master (branch is currently checked out)
error: failed to push some refs to '/Users/Omni/code/hooks'</pre>
    <ul class="note">
        <li>You don't need to try to read it all</li>
        <li>In fact, you probably shouldn't</li>
        <li>basically, what it's saying is that you're &rarr; doin'</li>
    </ul>
</section>

<section class="slide doin-it-rong">
    <img alt="http://knowyourmeme.com/photos/2626" class="centered"
            src="images/doing-it-wrong.jpg">
    <ul class="note">
        <li>doin' ... it rong</li>
        <li>Basically git is saying that someone's working there</li>
        <li>so don't mess with it</li>
        <li>But I push all the time and never see that you say?</li>
        <li>That's where a bare repo comes in</li>
    </ul>
</section>

<section class="slide">
    <pre class="cli">    $ mkdir hooks-bare
    $ cd hooks-bare
    $ git init --bare
    Initialized empty Git repository in /Users/Omni/Code/hooks-bare/
    <span class="repo">hooks-bare</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ ls
    HEAD         description  <span class="directory">info</span>/        <span class="directory">refs</span>/
    config       <span class="directory">hooks</span>/       <span class="directory">objects</span>/</pre>
    <ul class="note">
        <li>Creating a repository with git init --bare</li>
        <li>Puts a bunch of git stuff in there</li>
        <li>Obviously the hooks directory is what we're interested in</li>
        <li>Compare that to creating a new normal repository</li>
    </ul>
</section>

<section class="slide">
    <pre class="cli">    $ mkdir hooks
    $ cd hooks
    $ git init
    Initialized empty Git repository in /Users/Omni/Code/hooks/.git/
    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ ls</pre>
    <ul class="note">
        <li>Which has nothing in it</li>
        <li>Or does &rarr; it</li>
    </ul>
</section>

<section class="slide">
    <pre class="cli">    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ ls -A
    <span class="directory">.git</span>/
    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ ls -A .git
    HEAD         description  <span class="directory">info</span>/        <span class="directory">refs</span>/
    config       <span class="directory">hooks</span>/       <span class="directory">objects</span>/</pre>
    <ul class="note">
        <li>There's a hidden directory that holds all of git's stuff</li>
        <li>It looks pretty similar to the directories in a bare repo</li>
        <li>And again, it has the hooks directory</li>
    </ul>
</section>

<section class="slide">
    <pre class="cli">
    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ ls .git/hooks
    <span class="executable">applypatch-msg.sample</span>*     <span class="executable">pre-commit.sample</span>*
    <span class="executable">commit-msg.sample</span>*         <span class="executable">pre-rebase.sample</span>*
    <span class="executable">post-update.sample</span>*        <span class="executable">prepare-commit-msg.sample</span>*
    <span class="executable">pre-applypatch.sample</span>*     <span class="executable">update.sample</span>*
    </pre>
    <ul class="note">
        <li>Git has created a bunch of sample hooks for us</li>
        <li>If we just wanted to use one of those, we can rename it</li>
        <li>and remove the .sample extension</li>
        <li>Or we can create a new file with the name of the hook</li>
        <li>and make it executable</li>
    </ul>
</section>

<section class="slide">
    <pre class="cli">    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ cat &gt; .git/hooks/pre-commit
    echo 'You FAIL'
    exit 1^D
    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ chmod +x .git/hooks/pre-commit
    <span class="repo">hooks</span>(<span class="dirty">0</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ touch foo
    <span class="repo">hooks</span>(<span class="dirty">1</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ git add foo
    <span class="repo">hooks</span>(<span class="dirty">1</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ git status -s
    <span class="dirty">A</span>  foo
    <span class="repo">hooks</span>(<span class="dirty">1</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ git commit
    You FAIL
    <span class="repo">hooks</span>(<span class="dirty">1</span><span class="ahead">0</span><span class="behind">0</span>) <span class="directory">/</span>$ git status -s
    <span class="dirty">A</span>  foo</pre>
    <ul class="note">
        <li>There's nothing inherently magical about git hooks</li>
        <li>Here I'm writing two lines to a file and making it executable</li>
        <li>Then I try to commit a file</li>
        <li>you can see the git hook doesn't accept it</li>
        <li>Hopefully you will want your hooks to do more</li>
        <li>than insult the user
        <li>and exit with an error code to block the action</li>
    </ul>
</section>

<section class="slide lint">
    <img alt="http://commons.wikimedia.org/wiki/File:Navel_lint_ball.jpg"
            class="centered" src="images/belly-lint.jpg">
    <ul class="note">
        <li>Let's write a quick hook that runs PHP lint on the project</li>
        <li>when you try to commit</li>
        <li>and rejects the commit if things are broken</li>
        <li>Our earlier hook was written in bash</li>
        <li>You can write it in whatever you want</li>
        <li>Since this is a PHP conference I'll use PHP</li>
        <li>First, let's rewrite the earlier hook in PHP</li>
    </ul>
</section>

<section class="slide">
    <pre class="prettyprint">    #!/usr/bin/env php
    &lt;?php
    echo 'You FAIL';
    exit(1);</pre>
    <ul class="note">
        <li>There, easy enough</li>
        <li>Since we're running from the command line</li>
        <li>We need to tell your shell where to find PHP</li>
        <li>Then we write a normal PHP program</li>
    </ul>
</section>

<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<script src="deck.js/jquery-1.7.2.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script src="deck.js/extensions/hash/deck.hash.js"></script>
<script src="google-code-prettify/src/prettify.js"></script>
<script src="hooks.js"></script>

</body></html>
